<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pogadaj24 — Prototype</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#07060a; --card:#0f1724; --muted:#94a3b8; 
  --accent1:#7c3aed; --accent2:#06b6d4; --glow1:0 6px 30px rgba(124,58,237,0.24);
  --glow2:0 10px 40px rgba(6,182,212,0.18); --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box;}
html,body{height:100%;margin:0;background:var(--bg);color:#e6eef8;font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;-webkit-font-smoothing:antialiased;}
a{color:inherit;text-decoration:none;}
.container{max-width:1100px;margin:22px auto;padding:18px;}
header.app-header{display:flex;justify-content:center;margin-bottom:18px;}
.title{font-size:32px;font-weight:800;animation:glow 1.2s infinite alternate;}
@keyframes glow{
  0%{text-shadow:0 0 2px #fff,0 0 5px var(--accent1);}
  50%{text-shadow:0 0 4px #fff,0 0 10px var(--accent2);}
  100%{text-shadow:0 0 2px #fff,0 0 5px var(--accent1);}
}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); border-radius:14px;padding:14px;box-shadow:0 6px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03);}
.video-stage{position:relative;min-height:360px;border-radius:10px;overflow:hidden;background:linear-gradient(180deg,#020617, rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;}
video#remote{width:100%;height:400px;object-fit:cover;background:#000;display:block;}
.local-thumb{position:absolute;right:18px;bottom:18px;width:160px;height:120px;border-radius:10px;overflow:hidden;border:2px solid rgba(255,255,255,0.06);box-shadow:0 8px 30px rgba(0,0,0,0.6);}
.local-thumb video{width:100%;height:100%;object-fit:cover;}
.action-bar{display:flex;gap:12px;align-items:center;margin-top:12px;flex-wrap:wrap;justify-content:center;}
.btn{padding:14px 18px;border-radius:14px;border:none;cursor:pointer;font-weight:600;font-size:14px;box-shadow:0 8px 30px rgba(2,6,23,0.6);transition:transform .14s ease, box-shadow .14s ease;backdrop-filter: blur(6px);}
.btn:active{transform:translateY(2px);}
.btn.neon{color:white;background:linear-gradient(90deg,var(--accent1),var(--accent2));box-shadow:var(--glow1), var(--glow2);}
.btn.ghost{background:var(--glass); color:var(--muted); border:1px solid rgba(255,255,255,0.04);}
.btn.warn{background:linear-gradient(90deg,#f59e0b,#ef4444); color:#0b0a0a;}
.chat-box{height:300px;overflow:auto;padding:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:10px;border:1px solid rgba(255,255,255,0.02);margin-bottom:8px;}
.chat-input{display:flex;gap:8px;}
.input{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;}
.ad-top,.ad-bottom{background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);border-radius:12px;color:var(--muted);border:1px dashed rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;margin-bottom:12px;padding:10px;}
footer.footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center;}
.modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(0deg, rgba(2,6,23,0.9), rgba(2,6,23,0.9));backdrop-filter: blur(6px);padding:18px;z-index:100;}
.panel{width:100%;max-width:420px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);text-align:center;}
</style>
</head>
<body>
<div class="container">
  <header class="app-header">
    <div class="title">Pogadaj24</div>
  </header>

  <div class="ad-top card">Miejsce na górną reklamę</div>

  <main class="grid" style="display:flex;gap:18px;flex-wrap:wrap;justify-content:center;">
    <section class="card" style="flex:1;min-width:300px;max-width:600px;">
      <div class="video-stage">
        <video id="remote" autoplay playsinline></video>
        <div class="local-thumb"><video id="local" autoplay playsinline muted></video></div>
      </div>
      <div class="action-bar">
        <button id="startBtn" class="btn neon">Start</button>
        <button id="nextBtn" class="btn neon">Next</button>
        <button id="muteBtn" class="btn neon">Mute</button>
        <button id="stopBtn" class="btn neon">Stop</button>
      </div>
    </section>
    <aside class="card" style="flex:1;min-width:250px;max-width:400px;">
      <div class="chat-box" id="chatBox"></div>
      <div class="chat-input">
        <input id="chatText" class="input" placeholder="Napisz wiadomość...">
        <button id="sendBtn" class="btn neon">Wyślij</button>
      </div>
    </aside>
  </main>

  <div class="ad-bottom card">Miejsce na dolną reklamę</div>
  <footer class="footer">&copy; Pogadaj24 — prototyp</footer>
</div>

<div class="modal" id="loginModal">
  <div class="panel">
    <h2>Witaj w Pogadaj24</h2>
    <p>Wybierz opcję aby rozpocząć:</p>
    <button id="anonBtn" class="btn ghost" style="margin-right:6px;">Wejdź anonimowo</button>
    <button id="loginBtn" class="btn neon">Zaloguj (demo)</button>
  </div>
</div>

<script>
const WEBSOCKET_URL = 'ws://localhost:8080'; // <- po deployu podmień na publiczny URL np. wss://twoj-serwer.onrender.com

const localVideo=document.getElementById('local');
const remoteVideo=document.getElementById('remote');
const startBtn=document.getElementById('startBtn');
const nextBtn=document.getElementById('nextBtn');
const muteBtn=document.getElementById('muteBtn');
const stopBtn=document.getElementById('stopBtn');
const chatBox=document.getElementById('chatBox');
const sendBtn=document.getElementById('sendBtn');
const chatText=document.getElementById('chatText');
const loginModal=document.getElementById('loginModal');
const anonBtn=document.getElementById('anonBtn');
const loginBtn=document.getElementById('loginBtn');

let localStream=null;
let pc=null;
let ws=null;
let isMuted=false;

function addChat(who,msg){
  const el=document.createElement('div');
  el.innerHTML=`<strong>${who}:</strong> ${msg}`;
  chatBox.appendChild(el);
  chatBox.scrollTop=chatBox.scrollHeight;
}

async function startCamera(){
  try{
    localStream=await navigator.mediaDevices.getUserMedia({video:true,audio:true});
    localVideo.srcObject=localStream;
  }catch(e){
    addChat('System','Brak dostępu do kamery');
  }
}

function initWebSocket(){
  ws=new WebSocket(WEBSOCKET_URL);
  ws.onmessage=e=>{
    const data=JSON.parse(e.data);
    if(data.type==='offer'){
      pc.setRemoteDescription(data.offer)
        .then(()=>pc.createAnswer())
        .then(answer=>pc.setLocalDescription(answer))
        .then(()=>ws.send(JSON.stringify({type:'answer',answer:pc.localDescription})));
    }
    else if(data.type==='answer'){
      pc.setRemoteDescription(data.answer);
    }
    else if(data.type==='ice'){
      pc.addIceCandidate(data.candidate);
    }
    else if(data.type==='chat'){
      addChat('Partner',data.message);
    }
  };
}

function createPeerConnection(){
  pc=new RTCPeerConnection();
  pc.onicecandidate=e=>{
    if(e.candidate) ws.send(JSON.stringify({type:'ice',candidate:e.candidate}));
  };
  pc.ontrack=e=>{remoteVideo.srcObject=e.streams[0];};
  localStream.getTracks().forEach(t=>pc.addTrack(t,localStream));
}

anonBtn.onclick=loginBtn.onclick=()=>{
  loginModal.style.display='none';
  startCamera().then(()=>{initWebSocket();createPeerConnection();});
};

sendBtn.onclick=()=>{
  const t=chatText.value.trim();
  if(!t) return;
  chatText.value='';
  addChat('Ty',t);
  ws.send(JSON.stringify({type:'chat',message:t}));
};

startBtn.onclick=()=>{
  if(pc){
    pc.createOffer()
      .then(offer=>pc.setLocalDescription(offer))
      .then(()=>ws.send(JSON.stringify({type:'offer',offer:pc.localDescription})));
  }
};
muteBtn.onclick=()=>{
  if(localStream){
    isMuted=!isMuted;
    localStream.getAudioTracks().forEach(t=>t.enabled=!isMuted);
  }
};
nextBtn.onclick=()=>{addChat('System','Przechodzisz do następnego');};
stopBtn.onclick=()=>{addChat('System','Sesja zatrzymana');};
chatText.addEventListener('keypress',e=>{if(e.key==='Enter'){e.preventDefault();sendBtn.click();}});
</script>
</body>
</html>
